rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(
//    /databases/(default)/documents/users/$(request.auth.uid)).data.isAdmin;
service firebase.storage {
  match /b/{bucket}/o {
    // Images are stored under pets/{ownerUid}/{petId}/images/{file}
    match /pets/{ownerUid}/{petId}/{allPaths=**} {
      // Owners can read/write their own pet's images
      allow read, write: if request.auth != null && request.auth.uid == ownerUid;

      // Additionally, allow read for public pets
      allow read: if exists(/databases/(default)/documents/pets/$(petId)) &&
        (get(/databases/(default)/documents/pets/$(petId)).data.mode == 'Public');
    }
  }
}
